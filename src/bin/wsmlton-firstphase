#!/bin/bash

# This compiles the program to a .sml source file.

#TMP=/tmp/`whoami`/wavescript_parsed.tmp

source `dirname $0`/assert_wavescriptd

# Clean up first:
rm -f "query.sml"

if [ ! -f "$1" ];
then echo Usage: "wsmlton <file> <options> ...";
     if [ "$1" != "" ]; then echo   File \"$1\" does not exist.; 
     else cat $WAVESCRIPTD/bin/ws_opts.txt
     fi
     exit 1;
fi

#if [ ! -d /tmp/`whoami` ];  then mkdir /tmp/`whoami`; fi

# FILENAME MUST BE FIRST ARG
INFILE=$1
D=`dirname "$INFILE"`
B=`basename "$INFILE"`
abspath="`cd \"$D\" 2>/dev/null && pwd || echo \"$D\"`/$B"
shift



export WAVESCRIPT_OR_WAVESCRIPT=WS
#echo wavescript wsml $abspath ${1+"$@"} ;
#  Should pass some flags/arguments here maybe??:
echo wavescript wsml $abspath $*
if wavescript wsml $abspath $*
then echo
else #rm -f $TMP; 
    echo Compilation aborted: \"wavescript wscomp\" exited with error code.
    exit 1;
fi

